<?php
$user = null;
if (isset($_GET['tg'])) {
    $user = json_decode($_GET['tg'], true);
}
$username = $user['username'] ?? "Guest";
$first_name = $user['first_name'] ?? "";
$last_name = $user['last_name'] ?? "";
$user_id = $user['id'] ?? "N/A";
$full_name = trim($first_name . " " . $last_name);
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Gigapub Rewards Pro</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg-gradient: linear-gradient(145deg, #6a11cb, #2575fc, #ff6f91);
      --glass-bg: rgba(255, 255, 255, 0.08);
      --primary-accent: #ff6f91;
      --secondary-accent: #45ffbc;
      --text-light: #f9f9f9;
      --text-muted: #cfcfcf;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Poppins',sans-serif;background:var(--bg-gradient);min-height:100vh;color:var(--text-light);overflow-x:hidden;}
    .app-container{max-width:400px;margin:auto;padding-bottom:160px;min-height:100vh;position:relative;}
    .header{padding:20px;display:flex;justify-content:space-between;align-items:center;}
    .coins-display{display:flex;align-items:center;gap:12px;font-size:1.5rem;font-weight:600;}
    .coin-icon{font-size:32px;color:gold;}
    .section-heading{padding:10px 20px;font-size:1.2rem;font-weight:600;}
    .activities-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;padding:0 20px;}
    .activity-card{background:var(--glass-bg);border-radius:20px;padding:15px;text-align:center;cursor:pointer;transition:all .3s ease;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:130px;border:1px solid rgba(255,255,255,0.1);backdrop-filter:blur(10px);}
    .activity-card:hover{transform:translateY(-5px);background:rgba(69,255,188,0.15);}
    .activity-icon{font-size:2rem;margin-bottom:10px;background:-webkit-linear-gradient(135deg,var(--primary-accent),var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
    .activity-title{font-weight:600;font-size:.9rem;line-height:1.2;}
    .notice-bar{background-color:rgba(0,0,0,0.6);color:#ffd700;padding:8px 0;overflow:hidden;white-space:nowrap;}
    .notice-text{display:inline-block;padding-left:100%;animation:scroll-left 25s linear infinite;font-weight:500;}
    @keyframes scroll-left{0%{transform:translateX(0);}100%{transform:translateX(-100%);}}
    .bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);background:var(--glass-bg);backdrop-filter:blur(15px);max-width:400px;width:100%;display:flex;justify-content:space-around;padding:10px 0 20px;z-index:10;border-top:1px solid rgba(255,255,255,0.1);border-top-left-radius:25px;border-top-right-radius:25px;}
    .nav-item{text-align:center;color:var(--text-muted);font-size:12px;cursor:pointer;padding:5px 10px;}
    .nav-item.active{color:white;}
    .nav-icon{font-size:20px;margin-bottom:4px;}
    .nav-item.active .nav-icon{color:var(--primary-accent);}
    .toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#2ed573;color:white;padding:14px 22px;border-radius:12px;z-index:1000;animation:toastSlide .4s forwards,toastFade .4s 2.5s forwards;font-size:15px;box-shadow:0 5px 20px rgba(0,0,0,0.3);}
    @keyframes toastSlide{from{bottom:60px;opacity:0;}to{bottom:90px;opacity:1;}}
    @keyframes toastFade{from{opacity:1;}to{opacity:0;}}
    .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;}
    .modal-content{background:var(--glass-bg);backdrop-filter:blur(15px);border-radius:20px;padding:25px;width:85%;max-width:350px;text-align:center;color:var(--text-light);border:1px solid rgba(255,255,255,0.1);}
    .modal-content h2{margin-bottom:15px;font-size:1.3rem;}
    .modal-content p{margin:8px 0;}
    .profile-photo{width:90px;height:90px;border-radius:50%;object-fit:cover;margin-bottom:15px;border:3px solid var(--primary-accent);}
    .close-btn{margin-top:15px;padding:10px 18px;background:var(--primary-accent);border:none;border-radius:10px;cursor:pointer;color:white;font-weight:600;}
    .close-btn:hover{background:#ff4970;}
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="coins-display"><i class="fas fa-coins coin-icon"></i> <span id="coinBalance">0</span></div>
      <div><i class="fas fa-user-circle" id="profileBtn" style="font-size:28px; cursor:pointer;"></i></div>
    </div>

    <div class="notice-bar"><div class="notice-text">ðŸ”¥ Welcome Gigapub Rewards! Earn coins by completing tasks and spinning the wheel! ðŸ”¥</div></div>

    <div class="section-heading">Tasks</div>
    <div class="activities-grid">
      <div class="activity-card" onclick="handleTask(50,'daily_bonus')">
        <i class="fas fa-gift activity-icon"></i>
        <div class="activity-title">Daily Bonus</div>
      </div>
      <div class="activity-card" onclick="handleTask(30,'watch_video')">
        <i class="fas fa-play-circle activity-icon"></i>
        <div class="activity-title">Watch Ad</div>
      </div>
      <div class="activity-card" onclick="startSpin()">
        <i class="fas fa-spinner activity-icon"></i>
        <div class="activity-title">Spin Wheel</div>
      </div>
      <div class="activity-card" onclick="startScratch()">
        <i class="fas fa-sparkles activity-icon"></i>
        <div class="activity-title">Scratch Card</div>
      </div>
    </div>
    
<!-- Developer Contact -->
<div class="extra-buttons">
  <a href="https://t.me/Safinratul" target="_blank" style="text-decoration: none;">
    <button class="extra-btn" style="background:#0088cc; font-size:18px; padding:16px 24px; display:flex; align-items:center; justify-content:center; gap:10px;">
      <i class="fab fa-telegram-plane" style="font-size:22px;"></i> Developer By Md Safin Ahmed
    </button>
  </a>
</div>
  </div>


  <div class="bottom-nav">
    <div class="nav-item active"><i class="fas fa-home nav-icon"></i>Home</div>
    <div class="nav-item" id="profileNav"><i class="fas fa-user nav-icon"></i>Profile</div>
  </div>

  <div class="modal" id="profileModal">
    <div class="modal-content">
      <img id="profilePhoto" class="profile-photo" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Profile Photo">
      <h2>ðŸ‘¤ Profile</h2>
      <p><strong>Name:</strong> <span id="fullName"><?php echo $full_name ?: "Unknown"; ?></span></p>
      <p><strong>Username:</strong> @<span id="userName"><?php echo $username; ?></span></p>
      <p><strong>User ID:</strong> <span id="userId"><?php echo $user_id; ?></span></p>
      <a id="tgLink" href="https://t.me/<?php echo $username; ?>" target="_blank" class="close-btn">Open in Telegram</a>
      <br>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>
  
  <!-- Change Gigapub Ad Unit ID -->
  <script src="https://ad.gigapub.tech/script?id=3079"></script>
  
  <!-- Firebase Config -->
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAn2WwbHUzR5SdtUjhRMiPzShIZeYdxQzc",
      authDomain: "earning-bot-01.firebaseapp.com",
      databaseURL: "https://earning-bot-01-default-rtdb.firebaseio.com",
      projectId: "earning-bot-01",
      storageBucket: "earning-bot-01.firebasestorage.app",
      messagingSenderId: "429749652135",
      appId: "1:429749652135:web:094def28e351d472632982"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
  </script>

  <script>
    let coinBalance = 0;

    function addCoins(amount, source='') {
      coinBalance += amount;
      document.getElementById('coinBalance').textContent = coinBalance;
      showToast(`+${amount} coins from ${source}`);
    }

    function showToast(msg){
      let t=document.createElement('div');
      t.className='toast';
      t.textContent=msg;
      document.body.appendChild(t);
      setTimeout(()=>t.remove(),3000);
    }

    async function showGigapubAd() {
      try { await window.showGiga(); return true; }
      catch(e){ console.log('Ad not shown', e); return false; }
    }

    async function handleTask(reward, source) {
      showToast("Loading ad...");
      const adShown = await showGigapubAd();
      if(adShown){ addCoins(reward, source); }
      else { showToast("Ad failed. Try again."); }
    }

    function startSpin(){ showToast("Spin Wheel - Ad will show first."); handleTask(100,'spin_reward'); }
    function startScratch(){ showToast("Scratch Card - Ad will show first."); handleTask(75,'scratch_reward'); }

    const profileModal = document.getElementById("profileModal");
    document.getElementById("profileBtn").onclick = () => profileModal.style.display = "flex";
    document.getElementById("profileNav").onclick = () => profileModal.style.display = "flex";
    function closeModal(){ profileModal.style.display = "none"; }
    window.onclick = (e) => { if(e.target == profileModal){ closeModal(); } }

    window.onload = function(){
      const tg = window.Telegram.WebApp;
      const user = tg.initDataUnsafe?.user || {};
      if(user.id){
        document.getElementById("fullName").textContent = (user.first_name || "") + " " + (user.last_name || "");
        document.getElementById("userName").textContent = user.username || "unknown";
        document.getElementById("userId").textContent = user.id || "N/A";
        document.getElementById("tgLink").href = user.username ? `https://t.me/${user.username}` : "#";
        if(user.photo_url){
          document.getElementById("profilePhoto").src = user.photo_url;
        }
      }
    }
  </script>
</body>
</html>
